#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include "../../util/util.h"

void how_to_use(char *, char *);
int are_arguments_insufficient(int);

int main(int argc, char *argv[]){
	int file_descriptor, current_user_id;
	char *buffer, *filename;

	buffer = (char *) checked_malloc(100);
	filename = (char *) checked_malloc(50);

	strcpy(filename, "notes.txt");

	if(are_arguments_insufficient(argc)){
		how_to_use(argv[0], filename);
	}

	strcpy(buffer, argv[1]);

	printf("[DEBUG] buffer @ %p: %s \n", buffer, buffer);
	printf("[DEBUG] filename @ %p: %s \n", filename, filename);

	strncat(buffer, "\n", 1);

	file_descriptor = open(filename, O_WRONLY|O_CREAT|O_APPEND, S_IRUSR|S_IWUSR);
	if(file_descriptor == -1){
		fatal_error("in main() while opening the file");
	}
	printf("[DEBUG] file_descriptor is %d \n", file_descriptor);

	if(write(file_descriptor, buffer, strlen(buffer)) == -1){
		fatal_error("in main() while writing in the file");
	}

	if(close(file_descriptor) == -1){
		fatal_error("in main() while closing the file");
	}

	printf("Your note has been saved successfully. \n");
	free(buffer);
	free(filename);
}

void how_to_use(char *program_name, char *file_name){
	printf("Usage: %s <text to be added in %s> \n", program_name, file_name);
	exit(0);
}

int are_arguments_insufficient(int arguments_count){
	return arguments_count < 2;
}
